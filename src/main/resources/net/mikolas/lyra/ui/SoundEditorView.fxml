<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.image.*?>
<?import java.net.URL?>

<VBox xmlns="http://javafx.com/javafx" xmlns:fx="http://javafx.com/fxml"
      fx:controller="net.mikolas.lyra.ui.SoundEditorController"
      spacing="0" styleClass="sound-editor"
      prefWidth="1440" prefHeight="1290" minWidth="1440" minHeight="1290" maxWidth="1440" maxHeight="1290">

    <stylesheets>
        <URL value="@synth.css" />
    </stylesheets>

    <!-- BAND A: HEADER (56px matching web h-14) -->
    <HBox spacing="16" alignment="CENTER_LEFT" prefHeight="56" minHeight="56" maxHeight="56" styleClass="header-band">
        <padding><Insets left="16" right="16"/></padding>
        
        <HBox spacing="4" alignment="CENTER_LEFT">
            <Label text="BANK" styleClass="tactical-label"/>
            <Button text="&lt;" onAction="#handlePrevBank" styleClass="compact-button" prefWidth="24" prefHeight="24"/>
            <Label fx:id="bankDisplay" text="A" style="-fx-font-size: 12px; -fx-text-fill: white; -fx-min-width: 40px; -fx-alignment: center;"/>
            <Button text="&gt;" onAction="#handleNextBank" styleClass="compact-button" prefWidth="24" prefHeight="24"/>
        </HBox>

        <HBox spacing="4" alignment="CENTER_LEFT">
            <Label text="PROG" styleClass="tactical-label"/>
            <Button text="&lt;" onAction="#handlePrevProg" styleClass="compact-button" prefWidth="24" prefHeight="24"/>
            <Label fx:id="progDisplay" text="004" style="-fx-font-size: 12px; -fx-text-fill: white; -fx-min-width: 44px; -fx-alignment: center;"/>
            <Button text="&gt;" onAction="#handleNextProg" styleClass="compact-button" prefWidth="24" prefHeight="24"/>
        </HBox>

        <TextField fx:id="nameField" prefWidth="200" style="-fx-font-size: 14px;"/>
        <ComboBox fx:id="categoryCombo" prefWidth="120"/>
        
        <Region HBox.hgrow="ALWAYS"/>
        
        <HBox spacing="8" alignment="CENTER_RIGHT">
            <Button text="UNDO" styleClass="flat-button"/>
            <Button text="REDO" styleClass="flat-button"/>
            <Button text="SEND TO SYNTH" onAction="#handleSendToSynth" 
                    style="-fx-background-color: #00FFFF; -fx-text-fill: #050505; -fx-font-weight: bold; -fx-padding: 6 12; -fx-font-size: 11px;"/>
        </HBox>
    </HBox>

    <!-- Scrollable Body (Synthesis Core + Modulation Deck) -->
    <ScrollPane fitToWidth="true" hbarPolicy="NEVER" vbarPolicy="AS_NEEDED" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent; -fx-background: transparent;">
        <VBox spacing="8" style="-fx-padding: 8;">
            
            <!-- Synthesis Core - 3 columns (5fr 6fr 4fr) -->
            <GridPane hgap="8">
                <columnConstraints>
                    <ColumnConstraints percentWidth="33.333"/>
                    <ColumnConstraints percentWidth="40.0"/>
                    <ColumnConstraints percentWidth="26.667"/>
                </columnConstraints>
                
                <VBox spacing="8" GridPane.columnIndex="0">
                    <fx:include source="OscillatorView.fxml" fx:id="osc1"/>
                    <fx:include source="OscillatorView.fxml" fx:id="osc2"/>
                    <fx:include source="OscillatorView.fxml" fx:id="osc3"/>
                </VBox>

                <VBox spacing="8" GridPane.columnIndex="1">
                    <fx:include source="MixerView.fxml" fx:id="mixer"/>
                    <fx:include source="FilterView.fxml" fx:id="filter1"/>
                    <fx:include source="FilterView.fxml" fx:id="filter2"/>
                </VBox>

                <VBox spacing="8" GridPane.columnIndex="2" alignment="TOP_CENTER" fillWidth="true">
                    <fx:include source="AmpView.fxml" fx:id="amp"/>
                    <fx:include source="EffectView.fxml" fx:id="fx1"/>
                    <fx:include source="EffectView.fxml" fx:id="fx2"/>
                    <Region VBox.vgrow="ALWAYS"/>
                    <ImageView fitWidth="370" fitHeight="130" preserveRatio="true">
                        <image>
                            <Image url="@../../../../lyra_logo.png"/>
                        </image>
                    </ImageView>
                    <Region VBox.vgrow="ALWAYS"/>
                </VBox>
            </GridPane>

            <!-- LFO & Control Strip - 5 columns (1:1:1:1:1.2) -->
            <GridPane hgap="8">
                <columnConstraints>
                    <ColumnConstraints percentWidth="19.23"/>
                    <ColumnConstraints percentWidth="19.23"/>
                    <ColumnConstraints percentWidth="19.23"/>
                    <ColumnConstraints percentWidth="19.23"/>
                    <ColumnConstraints percentWidth="23.08"/>
                </columnConstraints>
                <fx:include source="LfoView.fxml" fx:id="lfo1" GridPane.columnIndex="0"/>
                <fx:include source="LfoView.fxml" fx:id="lfo2" GridPane.columnIndex="1"/>
                <fx:include source="LfoView.fxml" fx:id="lfo3" GridPane.columnIndex="2"/>
                <fx:include source="CommonSectionView.fxml" fx:id="common" GridPane.columnIndex="3"/>
                <fx:include source="ArpView.fxml" fx:id="arp" GridPane.columnIndex="4"/>
            </GridPane>

            <!-- Envelope Strip - 4 columns -->
            <GridPane hgap="8">
                <columnConstraints>
                    <ColumnConstraints percentWidth="25"/>
                    <ColumnConstraints percentWidth="25"/>
                    <ColumnConstraints percentWidth="25"/>
                    <ColumnConstraints percentWidth="25"/>
                </columnConstraints>
                <fx:include source="EnvelopeView.fxml" fx:id="filterEnv" GridPane.columnIndex="0"/>
                <fx:include source="EnvelopeView.fxml" fx:id="ampEnv" GridPane.columnIndex="1"/>
                <fx:include source="EnvelopeView.fxml" fx:id="env3" GridPane.columnIndex="2"/>
                <fx:include source="EnvelopeView.fxml" fx:id="env4" GridPane.columnIndex="3"/>
            </GridPane>
        </VBox>
    </ScrollPane>

    <!-- BAND D: FOOTER (44px matching web h-11) -->
    <HBox spacing="16" alignment="CENTER_LEFT" prefHeight="44" minHeight="44" maxHeight="44" styleClass="footer-band">
        <padding><Insets left="16" right="16"/></padding>
        <HBox spacing="12" alignment="CENTER_LEFT">
            <HBox spacing="6" alignment="CENTER_LEFT">
                <Region prefWidth="6" prefHeight="6" style="-fx-background-color: #00FFFF; -fx-background-radius: 10;"/>
                <Label text="MIDI IN" styleClass="tactical-label"/>
            </HBox>
            <HBox spacing="6" alignment="CENTER_LEFT">
                <Region prefWidth="6" prefHeight="6" style="-fx-background-color: #333; -fx-background-radius: 10;"/>
                <Label text="MIDI OUT" styleClass="tactical-label"/>
            </HBox>
        </HBox>
        <Region HBox.hgrow="ALWAYS"/>
        <HBox spacing="8" alignment="CENTER_RIGHT">
            <Button text="SAVE" styleClass="compact-button" prefHeight="24" prefWidth="60"/>
            <Button text="SAVE AS" styleClass="compact-button" prefHeight="24" prefWidth="70"/>
            <Button text="INIT" styleClass="compact-button" prefHeight="24" prefWidth="50"/>
            <Button text="RANDOM" styleClass="compact-button" prefHeight="24" prefWidth="65"/>
            <Button text="MOD MATRIX..." onAction="#handleOpenModMatrix"
                    style="-fx-background-color: #00FFFF; -fx-text-fill: #050505; -fx-font-weight: bold; -fx-padding: 4 10; -fx-font-size: 11px;"/>
        </HBox>
    </HBox>
</VBox>